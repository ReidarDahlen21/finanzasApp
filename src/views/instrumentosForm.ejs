<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Nuevo Instrumento</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto Condensed', sans-serif;
      background-color: #f8f9fa;
      padding: 2rem;
    }
    .small-form {
      max-width: 400px;
      margin: auto;
    }
  </style>
</head>
<body>
  <div class="small-form">
    <h3 class="mb-3">Agregar Instrumento</h3>
    <form action="/instrumentos" method="POST">
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input list="sugerencias" type="text" class="form-control form-control-sm" name="nombre" id="nombre" required>
		<datalist id="sugerencias"></datalist>
      </div>
      <div class="mb-3">
        <label for="tipo" class="form-label">Tipo</label>
        <input type="text" class="form-control form-control-sm" name="tipo">
      </div>
      <div class="mb-3">
        <label for="moneda_base" class="form-label">Moneda base</label>
        <select class="form-select form-select-sm" name="moneda_base" required>
          <option value="ARS">Pesos</option>
          <option value="USD">DÃ³lares</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary btn-sm">Guardar</button>
    </form>

    <hr class="my-4">
	<h5>Instrumentos cargados</h5>
	<table class="table table-sm table-bordered table-striped mt-3">
	  <thead class="table-light">
	    <tr>
	      <th>ID</th>
	      <th>Nombre</th>
	      <th>Tipo</th>
	      <th>Moneda Base</th>
	    </tr>
	  </thead>
	  <tbody>
	    <% instrumentos.forEach(inst => { %>
	      <tr>
	        <td><%= inst.id %></td>
	        <td><%= inst.nombre %></td>
	        <td><%= inst.tipo || '-' %></td>
	        <td><%= inst.moneda_base %></td>
	      </tr>
	    <% }) %>
	  </tbody>
	</table>
  </div>

  <script>
	  const nombreInput = document.getElementById('nombre');
	  const datalist = document.getElementById('sugerencias');

	  nombreInput.addEventListener('input', async () => {
	    const query = nombreInput.value.trim();
	    if (query.length < 2) return;

	    const res = await fetch(`/instrumentos/autocomplete?q=${encodeURIComponent(query)}`);
	    const nombres = await res.json();

	    datalist.innerHTML = '';
	    nombres.forEach(n => {
	      const option = document.createElement('option');
	      option.value = n;
	      datalist.appendChild(option);
	    });
	  });
	</script>


</body>
</html>
